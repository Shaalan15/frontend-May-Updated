{"ast":null,"code":"import { __assign, __extends } from \"tslib\";\n/* eslint-disable prettier/prettier */\n\nimport React from 'react';\nimport { GALLERY_CONSTS, ItemsHelper, window, utils, isEditMode, isSEOMode, isPreviewMode, isSiteMode } from 'pro-gallery-lib';\nimport GalleryView from './galleryView';\nimport SlideshowView from './slideshowView';\nimport { scrollToItemImp, scrollToGroupImp } from '../../helpers/scrollHelper';\nimport ScrollIndicator from './galleryScrollIndicator';\nimport { createCssLayouts } from '../../helpers/cssLayoutsHelper.js';\nimport { cssScrollHelper } from '../../helpers/cssScrollHelper.js';\nimport VideoScrollHelperWrapper from '../../helpers/videoScrollHelperWrapper';\nimport findNeighborItem from '../../helpers/layoutUtils';\nimport ImageRenderer from '../../item/imageRenderer';\n\nvar GalleryContainer =\n/** @class */\nfunction (_super) {\n  __extends(GalleryContainer, _super);\n\n  function GalleryContainer(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.findNeighborItem = function (itemIdx, dir) {\n      return findNeighborItem(itemIdx, dir, _this.state.structure.items);\n    }; // REFACTOR BLUEPRINTS - this makes the function in the layouter irrelevant (unless the layouter is used as a stand alone with this function, maybe the layouter needs to be split for bundle size as well...)\n\n\n    if (utils.isVerbose()) {\n      console.count('[OOISSR] galleryContainer constructor', window.isMock);\n    }\n\n    _this.getMoreItemsIfNeeded = _this.getMoreItemsIfNeeded.bind(_this);\n    _this.setGotFirstScrollIfNeeded = _this.setGotFirstScrollIfNeeded.bind(_this);\n    _this.toggleLoadMoreItems = _this.toggleLoadMoreItems.bind(_this);\n    _this.scrollToItem = _this.scrollToItem.bind(_this);\n    _this.scrollToGroup = _this.scrollToGroup.bind(_this);\n    _this._scrollingElement = _this.getScrollingElement();\n    _this.eventsListener = _this.eventsListener.bind(_this);\n    _this.onGalleryScroll = _this.onGalleryScroll.bind(_this);\n    _this.setPlayingIdxState = _this.setPlayingIdxState.bind(_this);\n    _this.getVisibleItems = _this.getVisibleItems.bind(_this);\n    _this.findNeighborItem = _this.findNeighborItem.bind(_this);\n    _this.setCurrentSlideshowViewIdx = _this.setCurrentSlideshowViewIdx.bind(_this);\n    _this.getIsScrollLessGallery = _this.getIsScrollLessGallery.bind(_this);\n    _this.onMouseEnter = _this.onMouseEnter.bind(_this);\n    _this.onMouseLeave = _this.onMouseLeave.bind(_this);\n    _this.videoScrollHelper = new VideoScrollHelperWrapper(_this.setPlayingIdxState);\n    var initialState = {\n      pgScroll: 0,\n      showMoreClickedAtLeastOnce: false,\n      initialGalleryHeight: undefined,\n      needToHandleShowMoreClick: false,\n      gotFirstScrollEvent: false,\n      playingVideoIdx: -1,\n      viewComponent: null,\n      firstUserInteractionExecuted: false,\n      isScrollLessGallery: _this.getIsScrollLessGallery(_this.props.styles),\n      isInHover: false\n    };\n    _this.state = initialState;\n    _this.layoutCss = [];\n    _this.initialGalleryState = {};\n\n    try {\n      var galleryState = _this.propsToState(props);\n\n      if (Object.keys(galleryState).length > 0) {\n        _this.initialGalleryState = galleryState;\n      }\n    } catch (_e) {\n      console.warn('Cannot create initial state from props', _e);\n    }\n\n    _this.state = __assign(__assign({}, initialState), _this.initialGalleryState);\n    return _this; //not sure if there needs to be a handleNEwGalleryStructure here with the intial state. currently looks like not\n  }\n\n  GalleryContainer.prototype.componentDidMount = function () {\n    this.scrollToItem(this.props.currentIdx, false, true, 0);\n    this.handleNewGalleryStructure();\n    this.eventsListener(GALLERY_CONSTS.events.APP_LOADED, {});\n    this.videoScrollHelper.initializePlayState();\n\n    try {\n      if (typeof window.CustomEvent === 'function') {\n        this.currentHoverChangeEvent = new CustomEvent('current_hover_change');\n      } else {\n        //IE (new CustomEvent is not supported in IE)\n        this.currentHoverChangeEvent = window.document.createEvent('CustomEvent'); // MUST be 'CustomEvent'\n\n        this.currentHoverChangeEvent.initCustomEvent('current_hover_change', false, false, null);\n      }\n    } catch (e) {\n      console.error(\"could not create 'current_hover_change' customEvent. Error =\", e);\n    }\n\n    if (this.props.domId) {\n      this.currentHoverChangeEvent.domId = this.props.domId;\n    }\n  };\n\n  GalleryContainer.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n    var _this = this;\n\n    if (!this.currentHoverChangeEvent.domId && nextProps.domId) {\n      this.currentHoverChangeEvent.domId = nextProps.domId;\n    }\n\n    if (this.props.currentIdx !== nextProps.currentIdx && nextProps.currentIdx !== this.currentSlideshowViewIdx) {\n      this.scrollToItem(nextProps.currentIdx, false, true, 0);\n    }\n\n    var reCreateGallery = function () {\n      var galleryState = _this.propsToState(nextProps);\n\n      if (Object.keys(galleryState).length > 0) {\n        _this.setState(galleryState, _this.handleNewGalleryStructure);\n      }\n    };\n\n    var getSignificantProps = function (props) {\n      var domId = props.domId,\n          styles = props.styles,\n          container = props.container,\n          items = props.items,\n          watermark = props.watermark,\n          isInDisplay = props.isInDisplay;\n      return {\n        domId: domId,\n        styles: styles,\n        container: container,\n        items: items,\n        watermark: watermark,\n        isInDisplay: isInDisplay\n      };\n    };\n\n    if (this.reCreateGalleryTimer) {\n      clearTimeout(this.reCreateGalleryTimer);\n    }\n\n    var hasPropsChanged = true;\n\n    try {\n      var currentSignificatProps = getSignificantProps(this.props);\n      var nextSignificatProps = getSignificantProps(nextProps);\n      hasPropsChanged = JSON.stringify(currentSignificatProps) !== JSON.stringify(nextSignificatProps);\n\n      if (utils.isVerbose() && hasPropsChanged) {\n        console.log('New props arrived', utils.printableObjectsDiff(currentSignificatProps, nextSignificatProps));\n      }\n    } catch (e) {\n      console.error('Cannot compare props', e);\n    }\n\n    if (hasPropsChanged) {\n      reCreateGallery();\n\n      if (!!nextProps.currentIdx && nextProps.currentIdx > 0) {\n        this.scrollToItem(nextProps.currentIdx, false, true, 0);\n      }\n\n      if (this.props.isInDisplay !== nextProps.isInDisplay) {\n        this.handleNavigation(nextProps.isInDisplay);\n      }\n    } else {//this is a hack, because in fullwidth, new props arrive without any changes\n      // this.reCreateGalleryTimer = setTimeout(reCreateGallery, 1000);\n    }\n  };\n\n  GalleryContainer.prototype.handleNavigation = function (isInDisplay) {\n    if (isInDisplay) {\n      this.videoScrollHelper.trigger.INIT_SCROLL();\n    } else {\n      this.videoScrollHelper.stop();\n    }\n  };\n\n  GalleryContainer.prototype.handleNewGalleryStructure = function () {\n    //should be called AFTER new state is set\n    var _a = this.state,\n        container = _a.container,\n        needToHandleShowMoreClick = _a.needToHandleShowMoreClick,\n        initialGalleryHeight = _a.initialGalleryHeight;\n    var styleParams = this.props.styles;\n    var numOfItems = this.state.items.length;\n    var layoutHeight = this.props.structure.height;\n    var layoutItems = this.props.structure.items;\n    var isInfinite = this.containerInfiniteGrowthDirection() === 'vertical';\n    var updatedHeight = false;\n    var needToUpdateHeightNotInfinite = !isInfinite && needToHandleShowMoreClick;\n\n    if (needToUpdateHeightNotInfinite) {\n      var showMoreContainerHeight = 138; //according to the scss\n\n      updatedHeight = container.height + (initialGalleryHeight - showMoreContainerHeight);\n    }\n\n    var onGalleryChangeData = {\n      numOfItems: numOfItems,\n      container: container,\n      styleParams: styleParams,\n      layoutHeight: layoutHeight,\n      layoutItems: layoutItems,\n      isInfinite: isInfinite,\n      updatedHeight: updatedHeight\n    };\n\n    if (utils.isVerbose()) {\n      console.log('handleNewGalleryStructure', onGalleryChangeData);\n    }\n\n    this.eventsListener(GALLERY_CONSTS.events.GALLERY_CHANGE, onGalleryChangeData);\n\n    if (needToHandleShowMoreClick) {\n      this.setState({\n        needToHandleShowMoreClick: false\n      });\n    }\n  };\n\n  GalleryContainer.prototype.isVerticalGallery = function () {\n    return !this.state.styles.oneRow;\n  };\n\n  GalleryContainer.prototype.getIsScrollLessGallery = function (styles) {\n    var oneRow = styles.oneRow,\n        slideAnimation = styles.slideAnimation;\n    return oneRow && slideAnimation !== GALLERY_CONSTS.slideAnimations.SCROLL;\n  };\n\n  GalleryContainer.prototype.getVisibleItems = function (items, container) {\n    var gotFirstScrollEvent = this.state.gotFirstScrollEvent;\n    var scrollY = window.scrollY;\n    var galleryHeight = container.galleryHeight,\n        scrollBase = container.scrollBase,\n        galleryWidth = container.galleryWidth;\n\n    if (utils.isSSR() || isSEOMode() || isEditMode() || gotFirstScrollEvent || scrollY > 0 || this.props.currentIdx > 0) {\n      return items;\n    }\n\n    var visibleItems = items;\n\n    try {\n      var windowHeight = window.innerHeight;\n      var isInfinite = this.isVerticalGallery() && this.containerInfiniteGrowthDirection() === 'vertical';\n      var galleryBottom = isInfinite ? Infinity : scrollBase + galleryHeight;\n      var windowBottom = scrollY + windowHeight;\n      var maxItemTop_1 = Math.min(galleryBottom, windowBottom) - scrollBase;\n\n      if (maxItemTop_1 < 0) {\n        //gallery is below the fold\n        visibleItems = [];\n      } else if (this.isVerticalGallery()) {\n        visibleItems = items.filter(function (item) {\n          return item.offset.top < maxItemTop_1;\n        });\n      } else {\n        visibleItems = items.filter(function (item) {\n          return item.left <= galleryWidth + 20;\n        });\n      }\n\n      if (visibleItems.length < 2 && visibleItems.length < items.length) {\n        //dont render less then 2 items (otherwise slide show Arrow will be removed)\n        visibleItems = items.slice(0, 2);\n      }\n    } catch (e) {\n      console.error('Could not calculate visible items, returning original items', e);\n      visibleItems = items;\n    }\n\n    return visibleItems;\n  };\n\n  GalleryContainer.prototype.propsToState = function (_a) {\n    var items = _a.items,\n        styles = _a.styles,\n        structure = _a.structure,\n        container = _a.container,\n        domId = _a.domId,\n        resizeMediaUrl = _a.resizeMediaUrl,\n        isPrerenderMode = _a.isPrerenderMode,\n        customImageRenderer = _a.customImageRenderer;\n    items = items || this.props.items;\n    styles = styles || this.props.styles;\n    container = container || this.props.container;\n    structure = structure || this.props.structure;\n    domId = domId || this.props.domId;\n    resizeMediaUrl = resizeMediaUrl || this.props.resizeMediaUrl;\n\n    if (typeof customImageRenderer === 'function') {\n      ImageRenderer.customImageRenderer = customImageRenderer;\n    }\n\n    this.galleryStructure = ItemsHelper.convertToGalleryItems(structure, {\n      // TODO use same objects in the memory when the galleryItems are changed\n      thumbnailSize: styles.thumbnailSize,\n      sharpParams: styles.sharpParams,\n      resizeMediaUrl: resizeMediaUrl\n    }); // // ------------ TODO. This is using GalleryItem and I am leaving it here for now ---------- //\n\n    var shouldUseScrollCss = !isSEOMode() && (isEditMode() || this.state.gotFirstScrollEvent || this.state.showMoreClickedAtLeastOnce);\n\n    if (shouldUseScrollCss) {\n      this.getScrollCss({\n        domId: domId,\n        items: this.galleryStructure.galleryItems,\n        styleParams: styles,\n        container: container\n      });\n    }\n\n    var scrollHelperNewGalleryStructure = {\n      galleryStructure: this.galleryStructure,\n      scrollBase: container.scrollBase,\n      videoPlay: styles.videoPlay,\n      videoLoop: styles.videoLoop,\n      itemClick: styles.itemClick,\n      oneRow: styles.oneRow,\n      cb: this.setPlayingIdxState\n    };\n    this.videoScrollHelper.updateGalleryStructure(scrollHelperNewGalleryStructure, !utils.isSSR(), items);\n    var layoutParams = {\n      items: items,\n      container: container,\n      styleParams: styles,\n      gotScrollEvent: true,\n      options: {\n        showAllItems: true,\n        skipVisibilitiesCalc: true,\n        useLayoutStore: false,\n        createLayoutOnInit: false\n      }\n    };\n    this.createCssLayoutsIfNeeded(layoutParams);\n    this.createDynamicStyles(styles, isPrerenderMode);\n    var newState = {\n      items: items,\n      styles: styles,\n      container: container,\n      structure: structure,\n      isScrollLessGallery: this.getIsScrollLessGallery(styles)\n    };\n    return newState;\n  };\n\n  GalleryContainer.prototype.getScrollingElement = function () {\n    var _this = this;\n\n    var horizontal = function () {\n      return window.document.querySelector(\"#pro-gallery-\" + _this.props.domId + \" #gallery-horizontal-scroll\");\n    };\n\n    var vertical = this.props.scrollingElement ? typeof this.props.scrollingElement === 'function' ? this.props.scrollingElement : function () {\n      return _this.props.scrollingElement;\n    } : function () {\n      return window;\n    };\n    return {\n      vertical: vertical,\n      horizontal: horizontal\n    };\n  };\n\n  GalleryContainer.prototype.scrollToItem = function (itemIdx, fixedScroll, isManual, durationInMS, scrollMarginCorrection) {\n    if (durationInMS === void 0) {\n      durationInMS = 0;\n    }\n\n    if (itemIdx >= 0) {\n      var scrollingElement = this._scrollingElement;\n      var horizontalElement = scrollingElement.horizontal();\n\n      try {\n        var scrollParams = {\n          scrollMarginCorrection: scrollMarginCorrection,\n          isRTL: this.state.styles.isRTL,\n          oneRow: this.state.styles.oneRow,\n          galleryWidth: this.state.container.galleryWidth,\n          galleryHeight: this.state.container.galleryHeight,\n          top: 0,\n          items: this.galleryStructure.items,\n          totalWidth: this.galleryStructure.width,\n          itemIdx: itemIdx,\n          fixedScroll: fixedScroll,\n          isManual: isManual,\n          scrollingElement: scrollingElement,\n          horizontalElement: horizontalElement,\n          durationInMS: durationInMS\n        };\n        return scrollToItemImp(scrollParams);\n      } catch (e) {\n        //added console.error to debug sentry error 'Cannot read property 'isRTL' of undefined in pro-gallery-statics'\n        console.error('error:', e, ' pro-gallery, scrollToItem, cannot get scrollParams, ', 'isEditMode =', isEditMode(), ' isPreviewMode =', isPreviewMode(), ' isSiteMode =', isSiteMode(), ' this.state.styles =', this.state.styles, ' this.state.container =', this.state.container, ' this.galleryStructure =', this.galleryStructure);\n      }\n    }\n  };\n\n  GalleryContainer.prototype.scrollToGroup = function (groupIdx, fixedScroll, isManual, durationInMS, scrollMarginCorrection) {\n    if (durationInMS === void 0) {\n      durationInMS = 0;\n    }\n\n    if (groupIdx >= 0) {\n      var scrollingElement = this._scrollingElement;\n      var horizontalElement = scrollingElement.horizontal();\n\n      try {\n        var scrollParams = {\n          scrollMarginCorrection: scrollMarginCorrection,\n          isRTL: this.state.styles.isRTL,\n          oneRow: this.state.styles.oneRow,\n          galleryWidth: this.state.container.galleryWidth,\n          galleryHeight: this.state.container.galleryHeight,\n          top: 0,\n          groups: this.galleryStructure.groups,\n          totalWidth: this.galleryStructure.width,\n          groupIdx: groupIdx,\n          fixedScroll: fixedScroll,\n          isManual: isManual,\n          scrollingElement: scrollingElement,\n          horizontalElement: horizontalElement,\n          durationInMS: durationInMS\n        };\n        return scrollToGroupImp(scrollParams);\n      } catch (e) {\n        //added console.error to debug sentry error 'Cannot read property 'isRTL' of undefined in pro-gallery-statics'\n        console.error('error:', e, ' pro-gallery, scrollToGroup, cannot get scrollParams, ', 'isEditMode =', isEditMode(), ' isPreviewMode =', isPreviewMode(), ' isSiteMode =', isSiteMode(), ' this.state.styles =', this.state.styles, ' this.state.container =', this.state.container, ' this.galleryStructure =', this.galleryStructure);\n      }\n    }\n  };\n\n  GalleryContainer.prototype.containerInfiniteGrowthDirection = function (styles) {\n    if (styles === void 0) {\n      styles = false;\n    }\n\n    var _styles = styles || this.props.styles; // return the direction in which the gallery can grow on it's own (aka infinite scroll)\n\n\n    var enableInfiniteScroll = this.props.styles.enableInfiniteScroll; //TODO - props or \"raw\" styles\n\n    var showMoreClickedAtLeastOnce = this.state.showMoreClickedAtLeastOnce;\n    var oneRow = _styles.oneRow,\n        loadMoreAmount = _styles.loadMoreAmount;\n\n    if (oneRow) {\n      return 'horizontal';\n    } else if (!enableInfiniteScroll) {\n      //vertical gallery with showMore button enabled\n      if (showMoreClickedAtLeastOnce && loadMoreAmount === 'all') {\n        return 'vertical';\n      } else {\n        return 'none';\n      }\n    } else {\n      return 'vertical';\n    }\n  };\n\n  GalleryContainer.prototype.setPlayingIdxState = function (playingVideoIdx) {\n    this.setState({\n      playingVideoIdx: playingVideoIdx\n    });\n  };\n\n  GalleryContainer.prototype.onGalleryScroll = function (_a) {\n    var top = _a.top,\n        left = _a.left;\n    this.videoScrollHelper.trigger.SCROLL({\n      top: top,\n      left: left\n    });\n  };\n\n  GalleryContainer.prototype.createDynamicStyles = function (_a, isPrerenderMode) {\n    var overlayBackground = _a.overlayBackground;\n    var useSSROpacity = isPrerenderMode && !this.props.settings.disableSSROpacity;\n    this.dynamicStyles = (\"\\n      \" + (!useSSROpacity ? '' : \"#pro-gallery-\" + this.props.domId + \" .gallery-item-container { opacity: 0 }\") + \"\\n      \" + (!overlayBackground ? '' : \"#pro-gallery-\" + this.props.domId + \" .gallery-item-hover::before { background: \" + overlayBackground + \" !important}\") + \"\\n    \").trim();\n  };\n\n  GalleryContainer.prototype.createCssLayoutsIfNeeded = function (layoutParams) {\n    var _a = this.props.settings,\n        settings = _a === void 0 ? {} : _a;\n    var avoidInlineStyles = settings.avoidInlineStyles;\n\n    if (avoidInlineStyles) {\n      this.layoutCss = createCssLayouts({\n        layoutParams: layoutParams,\n        isMobile: utils.isMobile(),\n        domId: this.props.domId,\n        galleryItems: this.galleryStructure.galleryItems\n      });\n    }\n  };\n\n  GalleryContainer.prototype.getScrollCss = function (_a) {\n    var domId = _a.domId,\n        items = _a.items,\n        styleParams = _a.styleParams,\n        container = _a.container;\n    this.scrollCss = cssScrollHelper.calcScrollCss({\n      items: items,\n      styleParams: styleParams,\n      domId: domId,\n      container: container\n    });\n  };\n\n  GalleryContainer.prototype.toggleLoadMoreItems = function () {\n    var _this = this;\n\n    this.eventsListener(GALLERY_CONSTS.events.LOAD_MORE_CLICKED, this.galleryStructure.galleryItems);\n    var showMoreClickedAtLeastOnce = true;\n    var needToHandleShowMoreClick = true; //before clicking \"load more\" at the first time\n\n    if (!this.state.showMoreClickedAtLeastOnce) {\n      this.getScrollCss({\n        domId: this.props.domId,\n        items: this.galleryStructure.galleryItems,\n        styleParams: this.state.styles,\n        container: this.state.container\n      });\n      var initialGalleryHeight = this.state.container.height; //container.height before clicking \"load more\" at the first time\n\n      this.setState({\n        showMoreClickedAtLeastOnce: showMoreClickedAtLeastOnce,\n        initialGalleryHeight: initialGalleryHeight,\n        needToHandleShowMoreClick: needToHandleShowMoreClick\n      }, function () {\n        _this.handleNewGalleryStructure();\n      });\n    } else {\n      //from second click\n      this.setState({\n        needToHandleShowMoreClick: needToHandleShowMoreClick\n      }, function () {\n        _this.handleNewGalleryStructure();\n      });\n    }\n  };\n\n  GalleryContainer.prototype.setGotFirstScrollIfNeeded = function () {\n    if (!this.state.gotFirstScrollEvent) {\n      this.getScrollCss({\n        domId: this.props.domId,\n        items: this.galleryStructure.galleryItems,\n        styleParams: this.state.styles,\n        container: this.state.container\n      });\n      this.setState({\n        gotFirstScrollEvent: true\n      });\n    }\n  };\n\n  GalleryContainer.prototype.setCurrentSlideshowViewIdx = function (idx) {\n    this.currentSlideshowViewIdx = idx;\n  };\n\n  GalleryContainer.prototype.simulateScrollToItem = function (item) {\n    (item === null || item === void 0 ? void 0 : item.offset) && this.onGalleryScroll(item.offset);\n  };\n\n  GalleryContainer.prototype.eventsListener = function (eventName, eventData, event) {\n    this.videoScrollHelper.handleEvent({\n      eventName: eventName,\n      eventData: eventData\n    });\n\n    if (eventName === GALLERY_CONSTS.events.HOVER_SET) {\n      this.currentHoverChangeEvent.currentHoverIdx = eventData;\n      window.dispatchEvent(this.currentHoverChangeEvent);\n    }\n\n    if (eventName === GALLERY_CONSTS.events.CURRENT_ITEM_CHANGED) {\n      this.setCurrentSlideshowViewIdx(eventData.idx);\n\n      if (this.state.isScrollLessGallery) {\n        this.simulateScrollToItem(this.galleryStructure.items[eventData.idx]);\n      }\n    }\n\n    if (!this.state.firstUserInteractionExecuted) {\n      switch (eventName) {\n        case GALLERY_CONSTS.events.HOVER_SET:\n        case GALLERY_CONSTS.events.LOAD_MORE_CLICKED:\n        case GALLERY_CONSTS.events.ITEM_ACTION_TRIGGERED:\n          this.setState({\n            firstUserInteractionExecuted: true\n          });\n          break;\n      }\n    }\n\n    if (typeof this.props.eventsListener === 'function') {\n      this.props.eventsListener(eventName, eventData, event);\n    }\n  };\n\n  GalleryContainer.prototype.getMoreItemsIfNeeded = function (scrollPos) {\n    var _this = this;\n\n    if (this.galleryStructure && this.galleryStructure.galleryItems && this.galleryStructure.galleryItems.length > 0 && !this.gettingMoreItems && this.state.items && this.state.styles && this.state.container) {\n      //more items can be fetched from the server\n      //TODO - add support for horizontal galleries\n      var _a = this.state.styles,\n          oneRow = _a.oneRow,\n          isRTL = _a.isRTL;\n      var galleryEnd = this.galleryStructure[oneRow ? 'width' : 'height'] + (oneRow ? 0 : this.state.container.scrollBase);\n      var screenSize = window.screen[oneRow ? 'width' : 'height'];\n      var scrollEnd = oneRow && isRTL ? scrollPos - galleryEnd + screenSize : scrollPos + screenSize;\n      var getItemsDistance = scrollPos ? 3 * screenSize : 0; //first scrollPos is 0 falsy. dont load before a scroll happened.\n\n      if (galleryEnd < getItemsDistance + scrollEnd) {\n        //only when the last item turns visible we should try getting more items\n        this.gettingMoreItems = true;\n        this.eventsListener(GALLERY_CONSTS.events.NEED_MORE_ITEMS, this.state.items.length);\n        setTimeout(function () {\n          //wait a bit before allowing more items to be fetched - ugly hack before promises still not working\n          _this.gettingMoreItems = false;\n        }, 2000);\n      }\n    }\n  };\n\n  GalleryContainer.prototype.canRender = function () {\n    var can = this.props.container && this.props.styles && this.state.items;\n\n    if (!can && utils.isVerbose()) {\n      console.log('PROGALLERY [CAN_RENDER] GalleryContainer', can, this.props.container, this.props.styles, this.state.items);\n    }\n\n    return can;\n  };\n\n  GalleryContainer.prototype.onMouseEnter = function () {\n    this.setState({\n      isInHover: true\n    });\n  };\n\n  GalleryContainer.prototype.onMouseLeave = function () {\n    this.setState({\n      isInHover: false\n    });\n  };\n\n  GalleryContainer.prototype.render = function () {\n    if (!this.canRender()) {\n      return null;\n    }\n\n    var ViewComponent = this.props.styles.oneRow ? SlideshowView : GalleryView;\n\n    if (utils.isVerbose()) {\n      console.count('PROGALLERY [COUNTS] - GalleryContainer (render)');\n      console.log('PROGALLERY [RENDER] - GalleryContainer', this.props.container.scrollBase, {\n        props: this.props,\n        items: this.state.items\n      });\n    }\n\n    var displayShowMore = this.containerInfiniteGrowthDirection() === 'none';\n    return React.createElement(\"div\", {\n      \"data-key\": \"pro-gallery-inner-container\",\n      key: \"pro-gallery-inner-container\",\n      className: this.props.isPrerenderMode ? 'pro-gallery-prerender' : '',\n      onMouseEnter: this.onMouseEnter,\n      onMouseLeave: this.onMouseLeave\n    }, React.createElement(ScrollIndicator, {\n      domId: this.props.domId,\n      oneRow: this.props.styles.oneRow,\n      isRTL: this.props.styles.isRTL,\n      totalWidth: this.galleryStructure.width,\n      scrollBase: this.props.container.scrollBase,\n      scrollingElement: this._scrollingElement,\n      getMoreItemsIfNeeded: this.getMoreItemsIfNeeded,\n      setGotFirstScrollIfNeeded: this.setGotFirstScrollIfNeeded,\n      onScroll: this.onGalleryScroll\n    }), React.createElement(ViewComponent, __assign({\n      isInDisplay: this.props.isInDisplay,\n      isPrerenderMode: this.props.isPrerenderMode,\n      scrollingElement: this._scrollingElement,\n      totalItemsCount: this.props.totalItemsCount,\n      renderedItemsCount: this.props.renderedItemsCount,\n      getMoreItemsIfNeeded: this.getMoreItemsIfNeeded,\n      gotFirstScrollEvent: this.state.gotFirstScrollEvent,\n      setGotFirstScrollIfNeeded: this.setGotFirstScrollIfNeeded,\n      items: this.state.items,\n      getVisibleItems: this.getVisibleItems,\n      itemsLoveData: this.props.itemsLoveData,\n      galleryStructure: this.galleryStructure,\n      styleParams: this.props.styles,\n      container: this.props.container,\n      watermark: this.props.watermark,\n      settings: this.props.settings,\n      displayShowMore: displayShowMore,\n      domId: this.props.domId,\n      currentIdx: this.props.currentIdx || 0,\n      customHoverRenderer: this.props.customHoverRenderer,\n      customInfoRenderer: this.props.customInfoRenderer,\n      customSlideshowInfoRenderer: this.props.customSlideshowInfoRenderer,\n      customLoadMoreRenderer: this.props.customLoadMoreRenderer,\n      customNavArrowsRenderer: this.props.customNavArrowsRenderer,\n      playingVideoIdx: this.state.playingVideoIdx,\n      noFollowForSEO: this.props.noFollowForSEO,\n      proGalleryRegionLabel: this.props.proGalleryRegionLabel,\n      firstUserInteractionExecuted: this.state.firstUserInteractionExecuted,\n      isGalleryInHover: this.state.isInHover,\n      actions: __assign(__assign({}, this.props.actions), {\n        findNeighborItem: this.findNeighborItem,\n        toggleLoadMoreItems: this.toggleLoadMoreItems,\n        eventsListener: this.eventsListener,\n        setWixHeight: function () {},\n        scrollToItem: this.scrollToItem,\n        scrollToGroup: this.scrollToGroup\n      })\n    }, this.props.gallery)), React.createElement(\"div\", {\n      \"data-key\": \"items-styles\",\n      key: \"items-styles\",\n      style: {\n        display: 'none'\n      }\n    }, (this.layoutCss || []).filter(Boolean).map(function (css, idx) {\n      return React.createElement(\"style\", {\n        id: \"layoutCss-\" + idx,\n        key: \"layoutCss-\" + idx,\n        dangerouslySetInnerHTML: {\n          __html: css\n        }\n      });\n    }), (this.scrollCss || []).filter(Boolean).map(function (css, idx) {\n      return React.createElement(\"style\", {\n        id: \"scrollCss_\" + idx,\n        key: \"scrollCss_\" + idx,\n        dangerouslySetInnerHTML: {\n          __html: css\n        }\n      });\n    }), !!this.dynamicStyles && React.createElement(\"style\", {\n      dangerouslySetInnerHTML: {\n        __html: this.dynamicStyles\n      }\n    })));\n  };\n\n  return GalleryContainer;\n}(React.Component);\n\nexport { GalleryContainer };\nexport default GalleryContainer;\n/* eslint-enable prettier/prettier */","map":{"version":3,"sources":["../../../../../src/components/gallery/proGallery/galleryContainer.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { __assign, __extends } from \"tslib\";\n/* eslint-disable prettier/prettier */\nimport React from 'react';\nimport { GALLERY_CONSTS, ItemsHelper, window, utils, isEditMode, isSEOMode, isPreviewMode, isSiteMode, } from 'pro-gallery-lib';\nimport GalleryView from './galleryView';\nimport SlideshowView from './slideshowView';\nimport { scrollToItemImp, scrollToGroupImp } from '../../helpers/scrollHelper';\nimport ScrollIndicator from './galleryScrollIndicator';\nimport { createCssLayouts } from '../../helpers/cssLayoutsHelper.js';\nimport { cssScrollHelper } from '../../helpers/cssScrollHelper.js';\nimport VideoScrollHelperWrapper from '../../helpers/videoScrollHelperWrapper';\nimport findNeighborItem from '../../helpers/layoutUtils';\nimport ImageRenderer from '../../item/imageRenderer';\nvar GalleryContainer = /** @class */ (function (_super) {\n    __extends(GalleryContainer, _super);\n    function GalleryContainer(props) {\n        var _this = _super.call(this, props) || this;\n        _this.findNeighborItem = function (itemIdx, dir) {\n            return findNeighborItem(itemIdx, dir, _this.state.structure.items);\n        }; // REFACTOR BLUEPRINTS - this makes the function in the layouter irrelevant (unless the layouter is used as a stand alone with this function, maybe the layouter needs to be split for bundle size as well...)\n        if (utils.isVerbose()) {\n            console.count('[OOISSR] galleryContainer constructor', window.isMock);\n        }\n        _this.getMoreItemsIfNeeded = _this.getMoreItemsIfNeeded.bind(_this);\n        _this.setGotFirstScrollIfNeeded = _this.setGotFirstScrollIfNeeded.bind(_this);\n        _this.toggleLoadMoreItems = _this.toggleLoadMoreItems.bind(_this);\n        _this.scrollToItem = _this.scrollToItem.bind(_this);\n        _this.scrollToGroup = _this.scrollToGroup.bind(_this);\n        _this._scrollingElement = _this.getScrollingElement();\n        _this.eventsListener = _this.eventsListener.bind(_this);\n        _this.onGalleryScroll = _this.onGalleryScroll.bind(_this);\n        _this.setPlayingIdxState = _this.setPlayingIdxState.bind(_this);\n        _this.getVisibleItems = _this.getVisibleItems.bind(_this);\n        _this.findNeighborItem = _this.findNeighborItem.bind(_this);\n        _this.setCurrentSlideshowViewIdx =\n            _this.setCurrentSlideshowViewIdx.bind(_this);\n        _this.getIsScrollLessGallery = _this.getIsScrollLessGallery.bind(_this);\n        _this.onMouseEnter = _this.onMouseEnter.bind(_this);\n        _this.onMouseLeave = _this.onMouseLeave.bind(_this);\n        _this.videoScrollHelper = new VideoScrollHelperWrapper(_this.setPlayingIdxState);\n        var initialState = {\n            pgScroll: 0,\n            showMoreClickedAtLeastOnce: false,\n            initialGalleryHeight: undefined,\n            needToHandleShowMoreClick: false,\n            gotFirstScrollEvent: false,\n            playingVideoIdx: -1,\n            viewComponent: null,\n            firstUserInteractionExecuted: false,\n            isScrollLessGallery: _this.getIsScrollLessGallery(_this.props.styles),\n            isInHover: false,\n        };\n        _this.state = initialState;\n        _this.layoutCss = [];\n        _this.initialGalleryState = {};\n        try {\n            var galleryState = _this.propsToState(props);\n            if (Object.keys(galleryState).length > 0) {\n                _this.initialGalleryState = galleryState;\n            }\n        }\n        catch (_e) {\n            console.warn('Cannot create initial state from props', _e);\n        }\n        _this.state = __assign(__assign({}, initialState), _this.initialGalleryState);\n        return _this;\n        //not sure if there needs to be a handleNEwGalleryStructure here with the intial state. currently looks like not\n    }\n    GalleryContainer.prototype.componentDidMount = function () {\n        this.scrollToItem(this.props.currentIdx, false, true, 0);\n        this.handleNewGalleryStructure();\n        this.eventsListener(GALLERY_CONSTS.events.APP_LOADED, {});\n        this.videoScrollHelper.initializePlayState();\n        try {\n            if (typeof window.CustomEvent === 'function') {\n                this.currentHoverChangeEvent = new CustomEvent('current_hover_change');\n            }\n            else {\n                //IE (new CustomEvent is not supported in IE)\n                this.currentHoverChangeEvent =\n                    window.document.createEvent('CustomEvent'); // MUST be 'CustomEvent'\n                this.currentHoverChangeEvent.initCustomEvent('current_hover_change', false, false, null);\n            }\n        }\n        catch (e) {\n            console.error(\"could not create 'current_hover_change' customEvent. Error =\", e);\n        }\n        if (this.props.domId) {\n            this.currentHoverChangeEvent.domId = this.props.domId;\n        }\n    };\n    GalleryContainer.prototype.UNSAFE_componentWillReceiveProps = function (nextProps) {\n        var _this = this;\n        if (!this.currentHoverChangeEvent.domId && nextProps.domId) {\n            this.currentHoverChangeEvent.domId = nextProps.domId;\n        }\n        if (this.props.currentIdx !== nextProps.currentIdx &&\n            nextProps.currentIdx !== this.currentSlideshowViewIdx) {\n            this.scrollToItem(nextProps.currentIdx, false, true, 0);\n        }\n        var reCreateGallery = function () {\n            var galleryState = _this.propsToState(nextProps);\n            if (Object.keys(galleryState).length > 0) {\n                _this.setState(galleryState, _this.handleNewGalleryStructure);\n            }\n        };\n        var getSignificantProps = function (props) {\n            var domId = props.domId, styles = props.styles, container = props.container, items = props.items, watermark = props.watermark, isInDisplay = props.isInDisplay;\n            return { domId: domId, styles: styles, container: container, items: items, watermark: watermark, isInDisplay: isInDisplay };\n        };\n        if (this.reCreateGalleryTimer) {\n            clearTimeout(this.reCreateGalleryTimer);\n        }\n        var hasPropsChanged = true;\n        try {\n            var currentSignificatProps = getSignificantProps(this.props);\n            var nextSignificatProps = getSignificantProps(nextProps);\n            hasPropsChanged =\n                JSON.stringify(currentSignificatProps) !==\n                    JSON.stringify(nextSignificatProps);\n            if (utils.isVerbose() && hasPropsChanged) {\n                console.log('New props arrived', utils.printableObjectsDiff(currentSignificatProps, nextSignificatProps));\n            }\n        }\n        catch (e) {\n            console.error('Cannot compare props', e);\n        }\n        if (hasPropsChanged) {\n            reCreateGallery();\n            if (!!nextProps.currentIdx && nextProps.currentIdx > 0) {\n                this.scrollToItem(nextProps.currentIdx, false, true, 0);\n            }\n            if (this.props.isInDisplay !== nextProps.isInDisplay) {\n                this.handleNavigation(nextProps.isInDisplay);\n            }\n        }\n        else {\n            //this is a hack, because in fullwidth, new props arrive without any changes\n            // this.reCreateGalleryTimer = setTimeout(reCreateGallery, 1000);\n        }\n    };\n    GalleryContainer.prototype.handleNavigation = function (isInDisplay) {\n        if (isInDisplay) {\n            this.videoScrollHelper.trigger.INIT_SCROLL();\n        }\n        else {\n            this.videoScrollHelper.stop();\n        }\n    };\n    GalleryContainer.prototype.handleNewGalleryStructure = function () {\n        //should be called AFTER new state is set\n        var _a = this.state, container = _a.container, needToHandleShowMoreClick = _a.needToHandleShowMoreClick, initialGalleryHeight = _a.initialGalleryHeight;\n        var styleParams = this.props.styles;\n        var numOfItems = this.state.items.length;\n        var layoutHeight = this.props.structure.height;\n        var layoutItems = this.props.structure.items;\n        var isInfinite = this.containerInfiniteGrowthDirection() === 'vertical';\n        var updatedHeight = false;\n        var needToUpdateHeightNotInfinite = !isInfinite && needToHandleShowMoreClick;\n        if (needToUpdateHeightNotInfinite) {\n            var showMoreContainerHeight = 138; //according to the scss\n            updatedHeight =\n                container.height + (initialGalleryHeight - showMoreContainerHeight);\n        }\n        var onGalleryChangeData = {\n            numOfItems: numOfItems,\n            container: container,\n            styleParams: styleParams,\n            layoutHeight: layoutHeight,\n            layoutItems: layoutItems,\n            isInfinite: isInfinite,\n            updatedHeight: updatedHeight,\n        };\n        if (utils.isVerbose()) {\n            console.log('handleNewGalleryStructure', onGalleryChangeData);\n        }\n        this.eventsListener(GALLERY_CONSTS.events.GALLERY_CHANGE, onGalleryChangeData);\n        if (needToHandleShowMoreClick) {\n            this.setState({ needToHandleShowMoreClick: false });\n        }\n    };\n    GalleryContainer.prototype.isVerticalGallery = function () {\n        return !this.state.styles.oneRow;\n    };\n    GalleryContainer.prototype.getIsScrollLessGallery = function (styles) {\n        var oneRow = styles.oneRow, slideAnimation = styles.slideAnimation;\n        return oneRow && slideAnimation !== GALLERY_CONSTS.slideAnimations.SCROLL;\n    };\n    GalleryContainer.prototype.getVisibleItems = function (items, container) {\n        var gotFirstScrollEvent = this.state.gotFirstScrollEvent;\n        var scrollY = window.scrollY;\n        var galleryHeight = container.galleryHeight, scrollBase = container.scrollBase, galleryWidth = container.galleryWidth;\n        if (utils.isSSR() ||\n            isSEOMode() ||\n            isEditMode() ||\n            gotFirstScrollEvent ||\n            scrollY > 0 ||\n            this.props.currentIdx > 0) {\n            return items;\n        }\n        var visibleItems = items;\n        try {\n            var windowHeight = window.innerHeight;\n            var isInfinite = this.isVerticalGallery() &&\n                this.containerInfiniteGrowthDirection() === 'vertical';\n            var galleryBottom = isInfinite ? Infinity : scrollBase + galleryHeight;\n            var windowBottom = scrollY + windowHeight;\n            var maxItemTop_1 = Math.min(galleryBottom, windowBottom) - scrollBase;\n            if (maxItemTop_1 < 0) {\n                //gallery is below the fold\n                visibleItems = [];\n            }\n            else if (this.isVerticalGallery()) {\n                visibleItems = items.filter(function (item) { return item.offset.top < maxItemTop_1; });\n            }\n            else {\n                visibleItems = items.filter(function (item) { return item.left <= galleryWidth + 20; });\n            }\n            if (visibleItems.length < 2 && visibleItems.length < items.length) {\n                //dont render less then 2 items (otherwise slide show Arrow will be removed)\n                visibleItems = items.slice(0, 2);\n            }\n        }\n        catch (e) {\n            console.error('Could not calculate visible items, returning original items', e);\n            visibleItems = items;\n        }\n        return visibleItems;\n    };\n    GalleryContainer.prototype.propsToState = function (_a) {\n        var items = _a.items, styles = _a.styles, structure = _a.structure, container = _a.container, domId = _a.domId, resizeMediaUrl = _a.resizeMediaUrl, isPrerenderMode = _a.isPrerenderMode, customImageRenderer = _a.customImageRenderer;\n        items = items || this.props.items;\n        styles = styles || this.props.styles;\n        container = container || this.props.container;\n        structure = structure || this.props.structure;\n        domId = domId || this.props.domId;\n        resizeMediaUrl = resizeMediaUrl || this.props.resizeMediaUrl;\n        if (typeof customImageRenderer === 'function') {\n            ImageRenderer.customImageRenderer = customImageRenderer;\n        }\n        this.galleryStructure = ItemsHelper.convertToGalleryItems(structure, {\n            // TODO use same objects in the memory when the galleryItems are changed\n            thumbnailSize: styles.thumbnailSize,\n            sharpParams: styles.sharpParams,\n            resizeMediaUrl: resizeMediaUrl,\n        });\n        // // ------------ TODO. This is using GalleryItem and I am leaving it here for now ---------- //\n        var shouldUseScrollCss = !isSEOMode() &&\n            (isEditMode() ||\n                this.state.gotFirstScrollEvent ||\n                this.state.showMoreClickedAtLeastOnce);\n        if (shouldUseScrollCss) {\n            this.getScrollCss({\n                domId: domId,\n                items: this.galleryStructure.galleryItems,\n                styleParams: styles,\n                container: container,\n            });\n        }\n        var scrollHelperNewGalleryStructure = {\n            galleryStructure: this.galleryStructure,\n            scrollBase: container.scrollBase,\n            videoPlay: styles.videoPlay,\n            videoLoop: styles.videoLoop,\n            itemClick: styles.itemClick,\n            oneRow: styles.oneRow,\n            cb: this.setPlayingIdxState,\n        };\n        this.videoScrollHelper.updateGalleryStructure(scrollHelperNewGalleryStructure, !utils.isSSR(), items);\n        var layoutParams = {\n            items: items,\n            container: container,\n            styleParams: styles,\n            gotScrollEvent: true,\n            options: {\n                showAllItems: true,\n                skipVisibilitiesCalc: true,\n                useLayoutStore: false,\n                createLayoutOnInit: false,\n            },\n        };\n        this.createCssLayoutsIfNeeded(layoutParams);\n        this.createDynamicStyles(styles, isPrerenderMode);\n        var newState = {\n            items: items,\n            styles: styles,\n            container: container,\n            structure: structure,\n            isScrollLessGallery: this.getIsScrollLessGallery(styles),\n        };\n        return newState;\n    };\n    GalleryContainer.prototype.getScrollingElement = function () {\n        var _this = this;\n        var horizontal = function () {\n            return window.document.querySelector(\"#pro-gallery-\" + _this.props.domId + \" #gallery-horizontal-scroll\");\n        };\n        var vertical = this.props.scrollingElement\n            ? typeof this.props.scrollingElement === 'function'\n                ? this.props.scrollingElement\n                : function () { return _this.props.scrollingElement; }\n            : function () { return window; };\n        return { vertical: vertical, horizontal: horizontal };\n    };\n    GalleryContainer.prototype.scrollToItem = function (itemIdx, fixedScroll, isManual, durationInMS, scrollMarginCorrection) {\n        if (durationInMS === void 0) { durationInMS = 0; }\n        if (itemIdx >= 0) {\n            var scrollingElement = this._scrollingElement;\n            var horizontalElement = scrollingElement.horizontal();\n            try {\n                var scrollParams = {\n                    scrollMarginCorrection: scrollMarginCorrection,\n                    isRTL: this.state.styles.isRTL,\n                    oneRow: this.state.styles.oneRow,\n                    galleryWidth: this.state.container.galleryWidth,\n                    galleryHeight: this.state.container.galleryHeight,\n                    top: 0,\n                    items: this.galleryStructure.items,\n                    totalWidth: this.galleryStructure.width,\n                    itemIdx: itemIdx,\n                    fixedScroll: fixedScroll,\n                    isManual: isManual,\n                    scrollingElement: scrollingElement,\n                    horizontalElement: horizontalElement,\n                    durationInMS: durationInMS,\n                };\n                return scrollToItemImp(scrollParams);\n            }\n            catch (e) {\n                //added console.error to debug sentry error 'Cannot read property 'isRTL' of undefined in pro-gallery-statics'\n                console.error('error:', e, ' pro-gallery, scrollToItem, cannot get scrollParams, ', 'isEditMode =', isEditMode(), ' isPreviewMode =', isPreviewMode(), ' isSiteMode =', isSiteMode(), ' this.state.styles =', this.state.styles, ' this.state.container =', this.state.container, ' this.galleryStructure =', this.galleryStructure);\n            }\n        }\n    };\n    GalleryContainer.prototype.scrollToGroup = function (groupIdx, fixedScroll, isManual, durationInMS, scrollMarginCorrection) {\n        if (durationInMS === void 0) { durationInMS = 0; }\n        if (groupIdx >= 0) {\n            var scrollingElement = this._scrollingElement;\n            var horizontalElement = scrollingElement.horizontal();\n            try {\n                var scrollParams = {\n                    scrollMarginCorrection: scrollMarginCorrection,\n                    isRTL: this.state.styles.isRTL,\n                    oneRow: this.state.styles.oneRow,\n                    galleryWidth: this.state.container.galleryWidth,\n                    galleryHeight: this.state.container.galleryHeight,\n                    top: 0,\n                    groups: this.galleryStructure.groups,\n                    totalWidth: this.galleryStructure.width,\n                    groupIdx: groupIdx,\n                    fixedScroll: fixedScroll,\n                    isManual: isManual,\n                    scrollingElement: scrollingElement,\n                    horizontalElement: horizontalElement,\n                    durationInMS: durationInMS,\n                };\n                return scrollToGroupImp(scrollParams);\n            }\n            catch (e) {\n                //added console.error to debug sentry error 'Cannot read property 'isRTL' of undefined in pro-gallery-statics'\n                console.error('error:', e, ' pro-gallery, scrollToGroup, cannot get scrollParams, ', 'isEditMode =', isEditMode(), ' isPreviewMode =', isPreviewMode(), ' isSiteMode =', isSiteMode(), ' this.state.styles =', this.state.styles, ' this.state.container =', this.state.container, ' this.galleryStructure =', this.galleryStructure);\n            }\n        }\n    };\n    GalleryContainer.prototype.containerInfiniteGrowthDirection = function (styles) {\n        if (styles === void 0) { styles = false; }\n        var _styles = styles || this.props.styles;\n        // return the direction in which the gallery can grow on it's own (aka infinite scroll)\n        var enableInfiniteScroll = this.props.styles.enableInfiniteScroll; //TODO - props or \"raw\" styles\n        var showMoreClickedAtLeastOnce = this.state.showMoreClickedAtLeastOnce;\n        var oneRow = _styles.oneRow, loadMoreAmount = _styles.loadMoreAmount;\n        if (oneRow) {\n            return 'horizontal';\n        }\n        else if (!enableInfiniteScroll) {\n            //vertical gallery with showMore button enabled\n            if (showMoreClickedAtLeastOnce && loadMoreAmount === 'all') {\n                return 'vertical';\n            }\n            else {\n                return 'none';\n            }\n        }\n        else {\n            return 'vertical';\n        }\n    };\n    GalleryContainer.prototype.setPlayingIdxState = function (playingVideoIdx) {\n        this.setState({\n            playingVideoIdx: playingVideoIdx,\n        });\n    };\n    GalleryContainer.prototype.onGalleryScroll = function (_a) {\n        var top = _a.top, left = _a.left;\n        this.videoScrollHelper.trigger.SCROLL({\n            top: top,\n            left: left,\n        });\n    };\n    GalleryContainer.prototype.createDynamicStyles = function (_a, isPrerenderMode) {\n        var overlayBackground = _a.overlayBackground;\n        var useSSROpacity = isPrerenderMode && !this.props.settings.disableSSROpacity;\n        this.dynamicStyles = (\"\\n      \" + (!useSSROpacity\n            ? ''\n            : \"#pro-gallery-\" + this.props.domId + \" .gallery-item-container { opacity: 0 }\") + \"\\n      \" + (!overlayBackground\n            ? ''\n            : \"#pro-gallery-\" + this.props.domId + \" .gallery-item-hover::before { background: \" + overlayBackground + \" !important}\") + \"\\n    \").trim();\n    };\n    GalleryContainer.prototype.createCssLayoutsIfNeeded = function (layoutParams) {\n        var _a = this.props.settings, settings = _a === void 0 ? {} : _a;\n        var avoidInlineStyles = settings.avoidInlineStyles;\n        if (avoidInlineStyles) {\n            this.layoutCss = createCssLayouts({\n                layoutParams: layoutParams,\n                isMobile: utils.isMobile(),\n                domId: this.props.domId,\n                galleryItems: this.galleryStructure.galleryItems,\n            });\n        }\n    };\n    GalleryContainer.prototype.getScrollCss = function (_a) {\n        var domId = _a.domId, items = _a.items, styleParams = _a.styleParams, container = _a.container;\n        this.scrollCss = cssScrollHelper.calcScrollCss({\n            items: items,\n            styleParams: styleParams,\n            domId: domId,\n            container: container,\n        });\n    };\n    GalleryContainer.prototype.toggleLoadMoreItems = function () {\n        var _this = this;\n        this.eventsListener(GALLERY_CONSTS.events.LOAD_MORE_CLICKED, this.galleryStructure.galleryItems);\n        var showMoreClickedAtLeastOnce = true;\n        var needToHandleShowMoreClick = true;\n        //before clicking \"load more\" at the first time\n        if (!this.state.showMoreClickedAtLeastOnce) {\n            this.getScrollCss({\n                domId: this.props.domId,\n                items: this.galleryStructure.galleryItems,\n                styleParams: this.state.styles,\n                container: this.state.container,\n            });\n            var initialGalleryHeight = this.state.container.height; //container.height before clicking \"load more\" at the first time\n            this.setState({\n                showMoreClickedAtLeastOnce: showMoreClickedAtLeastOnce,\n                initialGalleryHeight: initialGalleryHeight,\n                needToHandleShowMoreClick: needToHandleShowMoreClick,\n            }, function () {\n                _this.handleNewGalleryStructure();\n            });\n        }\n        else {\n            //from second click\n            this.setState({\n                needToHandleShowMoreClick: needToHandleShowMoreClick,\n            }, function () {\n                _this.handleNewGalleryStructure();\n            });\n        }\n    };\n    GalleryContainer.prototype.setGotFirstScrollIfNeeded = function () {\n        if (!this.state.gotFirstScrollEvent) {\n            this.getScrollCss({\n                domId: this.props.domId,\n                items: this.galleryStructure.galleryItems,\n                styleParams: this.state.styles,\n                container: this.state.container,\n            });\n            this.setState({\n                gotFirstScrollEvent: true,\n            });\n        }\n    };\n    GalleryContainer.prototype.setCurrentSlideshowViewIdx = function (idx) {\n        this.currentSlideshowViewIdx = idx;\n    };\n    GalleryContainer.prototype.simulateScrollToItem = function (item) {\n        (item === null || item === void 0 ? void 0 : item.offset) && this.onGalleryScroll(item.offset);\n    };\n    GalleryContainer.prototype.eventsListener = function (eventName, eventData, event) {\n        this.videoScrollHelper.handleEvent({\n            eventName: eventName,\n            eventData: eventData,\n        });\n        if (eventName === GALLERY_CONSTS.events.HOVER_SET) {\n            this.currentHoverChangeEvent.currentHoverIdx = eventData;\n            window.dispatchEvent(this.currentHoverChangeEvent);\n        }\n        if (eventName === GALLERY_CONSTS.events.CURRENT_ITEM_CHANGED) {\n            this.setCurrentSlideshowViewIdx(eventData.idx);\n            if (this.state.isScrollLessGallery) {\n                this.simulateScrollToItem(this.galleryStructure.items[eventData.idx]);\n            }\n        }\n        if (!this.state.firstUserInteractionExecuted) {\n            switch (eventName) {\n                case GALLERY_CONSTS.events.HOVER_SET:\n                case GALLERY_CONSTS.events.LOAD_MORE_CLICKED:\n                case GALLERY_CONSTS.events.ITEM_ACTION_TRIGGERED:\n                    this.setState({ firstUserInteractionExecuted: true });\n                    break;\n            }\n        }\n        if (typeof this.props.eventsListener === 'function') {\n            this.props.eventsListener(eventName, eventData, event);\n        }\n    };\n    GalleryContainer.prototype.getMoreItemsIfNeeded = function (scrollPos) {\n        var _this = this;\n        if (this.galleryStructure &&\n            this.galleryStructure.galleryItems &&\n            this.galleryStructure.galleryItems.length > 0 &&\n            !this.gettingMoreItems &&\n            this.state.items &&\n            this.state.styles &&\n            this.state.container) {\n            //more items can be fetched from the server\n            //TODO - add support for horizontal galleries\n            var _a = this.state.styles, oneRow = _a.oneRow, isRTL = _a.isRTL;\n            var galleryEnd = this.galleryStructure[oneRow ? 'width' : 'height'] +\n                (oneRow ? 0 : this.state.container.scrollBase);\n            var screenSize = window.screen[oneRow ? 'width' : 'height'];\n            var scrollEnd = oneRow && isRTL\n                ? scrollPos - galleryEnd + screenSize\n                : scrollPos + screenSize;\n            var getItemsDistance = scrollPos ? 3 * screenSize : 0; //first scrollPos is 0 falsy. dont load before a scroll happened.\n            if (galleryEnd < getItemsDistance + scrollEnd) {\n                //only when the last item turns visible we should try getting more items\n                this.gettingMoreItems = true;\n                this.eventsListener(GALLERY_CONSTS.events.NEED_MORE_ITEMS, this.state.items.length);\n                setTimeout(function () {\n                    //wait a bit before allowing more items to be fetched - ugly hack before promises still not working\n                    _this.gettingMoreItems = false;\n                }, 2000);\n            }\n        }\n    };\n    GalleryContainer.prototype.canRender = function () {\n        var can = this.props.container && this.props.styles && this.state.items;\n        if (!can && utils.isVerbose()) {\n            console.log('PROGALLERY [CAN_RENDER] GalleryContainer', can, this.props.container, this.props.styles, this.state.items);\n        }\n        return can;\n    };\n    GalleryContainer.prototype.onMouseEnter = function () {\n        this.setState({ isInHover: true });\n    };\n    GalleryContainer.prototype.onMouseLeave = function () {\n        this.setState({ isInHover: false });\n    };\n    GalleryContainer.prototype.render = function () {\n        if (!this.canRender()) {\n            return null;\n        }\n        var ViewComponent = this.props.styles.oneRow\n            ? SlideshowView\n            : GalleryView;\n        if (utils.isVerbose()) {\n            console.count('PROGALLERY [COUNTS] - GalleryContainer (render)');\n            console.log('PROGALLERY [RENDER] - GalleryContainer', this.props.container.scrollBase, { props: this.props, items: this.state.items });\n        }\n        var displayShowMore = this.containerInfiniteGrowthDirection() === 'none';\n        return (React.createElement(\"div\", { \"data-key\": \"pro-gallery-inner-container\", key: \"pro-gallery-inner-container\", className: this.props.isPrerenderMode ? 'pro-gallery-prerender' : '', onMouseEnter: this.onMouseEnter, onMouseLeave: this.onMouseLeave },\n            React.createElement(ScrollIndicator, { domId: this.props.domId, oneRow: this.props.styles.oneRow, isRTL: this.props.styles.isRTL, totalWidth: this.galleryStructure.width, scrollBase: this.props.container.scrollBase, scrollingElement: this._scrollingElement, getMoreItemsIfNeeded: this.getMoreItemsIfNeeded, setGotFirstScrollIfNeeded: this.setGotFirstScrollIfNeeded, onScroll: this.onGalleryScroll }),\n            React.createElement(ViewComponent, __assign({ isInDisplay: this.props.isInDisplay, isPrerenderMode: this.props.isPrerenderMode, scrollingElement: this._scrollingElement, totalItemsCount: this.props.totalItemsCount, renderedItemsCount: this.props.renderedItemsCount, getMoreItemsIfNeeded: this.getMoreItemsIfNeeded, gotFirstScrollEvent: this.state.gotFirstScrollEvent, setGotFirstScrollIfNeeded: this.setGotFirstScrollIfNeeded, items: this.state.items, getVisibleItems: this.getVisibleItems, itemsLoveData: this.props.itemsLoveData, galleryStructure: this.galleryStructure, styleParams: this.props.styles, container: this.props.container, watermark: this.props.watermark, settings: this.props.settings, displayShowMore: displayShowMore, domId: this.props.domId, currentIdx: this.props.currentIdx || 0, customHoverRenderer: this.props.customHoverRenderer, customInfoRenderer: this.props.customInfoRenderer, customSlideshowInfoRenderer: this.props.customSlideshowInfoRenderer, customLoadMoreRenderer: this.props.customLoadMoreRenderer, customNavArrowsRenderer: this.props.customNavArrowsRenderer, playingVideoIdx: this.state.playingVideoIdx, noFollowForSEO: this.props.noFollowForSEO, proGalleryRegionLabel: this.props.proGalleryRegionLabel, firstUserInteractionExecuted: this.state.firstUserInteractionExecuted, isGalleryInHover: this.state.isInHover, actions: __assign(__assign({}, this.props.actions), { findNeighborItem: this.findNeighborItem, toggleLoadMoreItems: this.toggleLoadMoreItems, eventsListener: this.eventsListener, setWixHeight: function () { }, scrollToItem: this.scrollToItem, scrollToGroup: this.scrollToGroup }) }, this.props.gallery)),\n            React.createElement(\"div\", { \"data-key\": \"items-styles\", key: \"items-styles\", style: { display: 'none' } },\n                (this.layoutCss || []).filter(Boolean).map(function (css, idx) { return (React.createElement(\"style\", { id: \"layoutCss-\" + idx, key: \"layoutCss-\" + idx, dangerouslySetInnerHTML: { __html: css } })); }),\n                (this.scrollCss || []).filter(Boolean).map(function (css, idx) { return (React.createElement(\"style\", { id: \"scrollCss_\" + idx, key: \"scrollCss_\" + idx, dangerouslySetInnerHTML: { __html: css } })); }),\n                !!this.dynamicStyles && (React.createElement(\"style\", { dangerouslySetInnerHTML: { __html: this.dynamicStyles } })))));\n    };\n    return GalleryContainer;\n}(React.Component));\nexport { GalleryContainer };\nexport default GalleryContainer;\n/* eslint-enable prettier/prettier */\n//# sourceMappingURL=galleryContainer.js.map"]},"metadata":{},"sourceType":"module"}